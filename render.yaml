services:
  # Web service - serves both frontend and backend
  - type: web
    name: codeconnect-live
    runtime: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: free  # Free tier
    region: oregon

    # Environment variables
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: codeconnect-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: ALGORITHM
        value: HS256
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: "10080"
      - key: DEBUG
        value: "false"
      - key: CORS_ORIGINS
        value: '["https://codeconnect-live.onrender.com"]'
      - key: APP_NAME
        value: "CodeView Backend"

    # Health check
    healthCheckPath: /health

    # Auto-deploy on push to main
    autoDeploy: false  # Controlled by GitHub Actions instead

# PostgreSQL database
databases:
  - name: codeconnect-db
    plan: free  # Free tier (1GB storage, expires after 90 days)
    databaseName: codeconnect
    user: codeconnect_user
    region: oregon
    ipAllowList: []
